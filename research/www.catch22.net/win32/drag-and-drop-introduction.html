<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  
<!-- Mirrored from www.catch22.net/tuts/win32/drag-and-drop-introduction by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 Apr 2022 20:48:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Drag and Drop Introduction - Catch22</title>
<meta name="description" content="The aim of this series of tutorials is to enable the reader to implement complete drag and drop support for their applications. Drag and drop became a standard feature of many Windows applications when Windows 95 was launched. With COM and OLE becoming more mainstream at this time, applications had the power to interact seamlessly with the Windows Shell and even other Windows applications. This flexibility came at a price though. Writing any form of COM or OLE enabled appliction is a complete nightmare, to put it mildly.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Catch22">
<meta property="og:title" content="Drag and Drop Introduction">
<meta property="og:url" content="drag-and-drop-introduction.html">


  <meta property="og:description" content="The aim of this series of tutorials is to enable the reader to implement complete drag and drop support for their applications. Drag and drop became a standard feature of many Windows applications when Windows 95 was launched. With COM and OLE becoming more mainstream at this time, applications had the power to interact seamlessly with the Windows Shell and even other Windows applications. This flexibility came at a price though. Writing any form of COM or OLE enabled appliction is a complete nightmare, to put it mildly.">







  <meta property="article:published_time" content="2004-02-15T00:00:00+00:00">






<link rel="canonical" href="drag-and-drop-introduction.html">













<!-- end _includes/seo.html -->


<link href="http://www.catch22.net/feed.xml" type="application/atom+xml" rel="alternate" title="Catch22 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://www.catch22.net/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--tutorial wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="http://www.catch22.net/">Catch22</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="http://www.catch22.net/blog/" >Blog</a>
            </li><li class="masthead__menu-item">
              <a href="http://www.catch22.net/software/" >Software</a>
            </li><li class="masthead__menu-item">
              <a href="../index.html" >Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="http://www.catch22.net/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://www.catch22.net/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://www.catch22.net/tuts" itemprop="item"><span itemprop="name">Tuts</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
                
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="../win32.html" itemprop="item"><span itemprop="name">Win32</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
                
      
    
      
      
        <li class="current">Drag and Drop Introduction</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Drag and Drop Introduction">
    <meta itemprop="description" content="The aim of this series of tutorials is to enable the reader to implement complete drag and drop support for their applications. Drag and drop became a standard feature of many Windows applications when Windows 95 was launched. With COM and OLE becoming more mainstream at this time, applications had the power to interact seamlessly with the Windows Shell and even other Windows applications. This flexibility came at a price though. Writing any form of COM or OLE enabled appliction is a complete nightmare, to put it mildly.">
    <meta itemprop="datePublished" content="February 15, 2004">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Drag and Drop Introduction
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <!--h1>Drag and Drop Introduction</h1-->
<!--h3>Introducing the OLE and COM technologies</h3-->

<p>The aim of this series of tutorials is to enable the reader to implement complete drag and drop support for their applications. Drag and drop became a standard feature of many Windows applications when Windows 95 was launched. With COM and OLE becoming more mainstream at this time, applications had the power to interact seamlessly with the Windows Shell and even other Windows applications. This flexibility came at a price though. Writing any form of COM or OLE enabled appliction is a complete nightmare, to put it mildly.</p>

<p>This tutorial will ease you through the pain of writing the required OLE interfaces necessary to enable drag and drop behaviour. As usual, we will use pure Win32 API techniques. However, I will be using C++ rather than C, because C++ is definitely the preferred language to write COM interfaces with. It would be a simple matter to convert the code to C as I will also explain.</p>

<p>I intend this tutorial to be written in several parts, as there is alot of information to cover. Also, the components of drag-and-drop lend themselves very nicely to separate topics, so this is the approach I will use. The first tutorial (this one, in fact) will provide an introduction to OLE Drag and Drop. Subsequent tutorials will focus on drag-and drop. Parts 2 and 3 will cover OLE data transfers the <code class="highlighter-rouge">IDataObject</code> interface. Part 4 will look at the <code class="highlighter-rouge">IEnumFORMATETC</code> interface, whilst parts 5 and 6 will cover drag-sources and drop-targets.</p>

<p>Once we have covered these basic details there will be further tutorials discussing drag-and-drop in more detail.</p>

<h2 id="additional-reading">Additional Reading</h2>

<p>I strongly suggest you investigate the following sources of information, because this is where I learnt about COM, OLE and drag&amp;drop.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp ftp.microsoft.com
username "ftp"
password "ftp"
cd softlib/mslfiles
bin
get drgdrps.exe
get drgdrpt.exe
bye
</code></pre></div></div>

<ol>
  <li><a href="http://msdn.microsoft.com/">msdn.microsoft.com</a>
The starting place for everything win32 related.</li>
  <li><strong>Inside OLE 2nd edition</strong> has alot of very useful information, and is regarded as the “bible” for OLE. It’s a little dated but contains everything you need to know. A “softcopy” version of this book used to be included in MSDN, and maybe it still is. There are also alot of softcopy versions in pdf and chm format floating around the internet.</li>
  <li><a href="ftp://ftp.microsoft.com/softlib/mslfiles">ftp.microsoft.com</a>
Microsoft’s FTP server contains hundreds of resources dating years back. The most useful thing I’ve found there so far are two small files - <strong>drgdrps.exe</strong> and <strong>drgdrpt.exe</strong>. These are self-extracting ZIP files which contain full source to a simple drop-source and drop-target application. To access these files simply goto your command prompt and type:</li>
  <li><strong>Microsoft Technical Articles</strong> - in particular the “OLE for Idiots” series, and “What OLE Is Really About”. These articles are quite old now (getting on for 10 years or so) but are still relevant today. A simple google search will locate these articles.</li>
</ol>

<h2 id="ole-drag-and-drop">OLE Drag and Drop</h2>

<p>“Drag and Drop” is a term used to describe the action of using a mouse to transfer data from one place to another.</p>

<p>Every Drag and Drop operation is comprised of three elements. These elements are of course COM objects which must be implemented by any application that wants to support drag and drop.</p>

<ul>
  <li>The <strong>Source</strong> of the drag-drop is represented by the <code class="highlighter-rouge">IDropSource</code> interface. The <code class="highlighter-rouge">IDropSource</code> contains methods for generating visual feedback, and for cancelling or completing the drag-drop operation.</li>
  <li>The <strong>Target</strong> of the drag-drop is represented by the <code class="highlighter-rouge">IDropTarget</code> interface.</li>
  <li>The <strong>Data</strong> being transferred is represented by the <code class="highlighter-rouge">IDataObject</code> interface.</li>
</ul>

<p>Note that an application doesn’t need to support all three COM interfaces - if you just want to make a “drop target”, then only the <code class="highlighter-rouge">IDropTarget</code> interface is required. Similarly, an application which just supports dragging data from it (and not to it) is required to support the <code class="highlighter-rouge">IDropSource</code> and <code class="highlighter-rouge">IDataObject</code> interfaces. Of course, an application can implement all three interfaces to support full drag and drop within the same document.</p>

<p><img src="http://www.catch22.net/assets/img/dragdrop04.gif" alt="" class="align-center" /></p>

<p>The diagram above illustrates the key components required to support a drag and drop operation. Take a moment to understand what the diagram is presenting. The box on the left is the initiator of a drag-and-drop operation. It has created two COM objects which each expose an interface (<code class="highlighter-rouge">IDataObject</code> and <code class="highlighter-rouge">IDropSource</code>), which are used by OLE to perform the drag-drop.</p>

<p>The box on the right represents the destination of the drag-and-drop operation. It has created a single COM object (with a single interface <code class="highlighter-rouge">IDropTarget</code>). Whenever the mouse is dragged over a drop target window, OLE passes an <code class="highlighter-rouge">IDataObject</code> interface to the target which allows the target to “see” the data object exposed by the source. The object doesn’t get copied in any way - just the COM interface is made available. When the target extracts data from the data object, the OLE/COM runtime takes care of marshalling the function calls and data across the process boundaries.</p>

<p>In this example the source and destination can be either implemented within the same process, or can be in seperate processes. It isn’t important where they are implemented, because the OLE runtime (COM, in fact) takes care of making the Data Object available to the destination process.</p>

<h2 id="starting-drag-and-drop">Starting Drag and Drop</h2>

<p>The first task any application must perform when it wants to use the OLE functions is to call <code class="highlighter-rouge">OleInitialize</code> when it starts, and <code class="highlighter-rouge">OleUnintialize</code> when it finishes. This is not quite accurate though - it is better to say the <em>thread</em> that wants to use OLE must call these functions, because COM and OLE must be initialized and uninitialized on a <em>per thread basis</em>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WINOLEAPI</span> <span class="n">OleInitialize</span><span class="p">(</span><span class="n">LPVOID</span> <span class="n">pvReserved</span><span class="p">);</span>
<span class="n">WINOLEAPI</span> <span class="n">OleUninitialize</span><span class="p">();</span>
</code></pre></div></div>

<p>At the very heart of OLE drag and drop is an API called <code class="highlighter-rouge">DoDragDrop</code>. The function prototype has the following form:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WINOLEAPI</span> <span class="n">DoDragDrop</span><span class="p">(</span>
   <span class="n">IDataObject</span> <span class="o">*</span> <span class="n">pDataObject</span><span class="p">,</span> <span class="c1">// Pointer to the data object
</span>   <span class="n">IDropSource</span> <span class="o">*</span> <span class="n">pDropSource</span><span class="p">,</span> <span class="c1">// Pointer to the source
</span>   <span class="n">DWORD</span> <span class="n">dwOKEffect</span><span class="p">,</span> <span class="c1">// Effects allowed by the source
</span>   <span class="n">DWORD</span> <span class="o">*</span> <span class="n">pdwEffect</span> <span class="c1">// Pointer to effects on the source
</span>   <span class="p">);</span>
</code></pre></div></div>

<p>When an application wants to initiate a drag and drop operation it must call this function. However there are two important steps which must take place before <code class="highlighter-rouge">DoDragDrop</code> is called.</p>

<p>Both the <code class="highlighter-rouge">IDataObject</code> and <code class="highlighter-rouge">IDropSource</code> objects must be created by the initiator of the drag-drop operation, <em>before</em> calling <code class="highlighter-rouge">DoDragDrop</code>. Creating these two objects is non-trivial and is therefore covered in the next section of this tutorial. Note that no mention of GUI related objects (such as windows) has been made so far. A drop source is a stand-alone entity that is not tied to any one window, although usually a drag-drop operation is initiated when a window procedure processes a <code class="highlighter-rouge">WM_MOUSEMOVE</code> message.</p>

<p>When <code class="highlighter-rouge">DoDragDrop</code> is called, a modal message loop is entered which monitors mouse and keyboard messages.</p>

<h2 id="receiving-drag-and-drop-data">Receiving Drag and Drop data</h2>

<p>When an application wants to be the recipient of a drag-and-drop operation, it must call the <code class="highlighter-rouge">RegisterDragDrop</code> function. Of course, this application must call <code class="highlighter-rouge">OleInitialize</code> / <code class="highlighter-rouge">OleUninitialize</code> in the same way the source application must.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WINOLEAPI</span> <span class="n">RegisterDragDrop</span><span class="p">(</span>
   <span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span> <span class="c1">// Handle to a window that can accept drops
</span>   <span class="n">IDropTarget</span> <span class="o">*</span> <span class="n">pDropTarget</span> <span class="c1">// Pointer to object that is to be target of drop
</span>   <span class="p">);</span>
</code></pre></div></div>

<p>Looking at the function prototype above reveals the last component to a drag-drop-operation - the <code class="highlighter-rouge">IDropTarget</code> COM interface. Also required is a handle to a window, which <code class="highlighter-rouge">RegisterDragDrop</code> requires in addition to the <code class="highlighter-rouge">IDropTarget</code> interface. This window is registered with the OLE runtime, so that when the mouse is dragged over this window, OLE can call the methods in the <code class="highlighter-rouge">IDropTarget</code> interface to notify the application owning that window that a drag-drop operation is in progress.</p>

<p>When a window is to be destroyed, the <code class="highlighter-rouge">RevokeDragDrop</code> API must be called:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WINOLEAPI</span> <span class="n">RevokeDragDrop</span><span class="p">(</span>
   <span class="n">HWND</span> <span class="n">hwnd</span> <span class="c1">// Handle to a window that can accept drops
</span>   <span class="p">);</span>
</code></pre></div></div>

<p>This API unregisters the specified window with the OLE runtime, and releases the <code class="highlighter-rouge">IDropTarget</code> interface used during registration and releases the <code class="highlighter-rouge">DropTarget</code> object in the process.</p>

<h2 id="coming-up-in-part-2---ole-data-transfers">Coming up in Part 2 - OLE Data Transfers</h2>

<p>So far I have presented an overview of OLE drag and drop. There is still alot more ground to cover, so over the next parts of this tutorial we will be looking at the core components of drag and drop. Coming up is the subject of OLE data transfers, but for now it would be a good idea to visit <a href="http://msdn.microsoft.com/" title="http://msdn.microsoft.com">http://msdn.microsoft.com</a> and review the documentation for <code class="highlighter-rouge">DoDragDrop</code> and <code class="highlighter-rouge">RegisterDragDrop</code>.</p>



        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2004-02-15T00:00:00+00:00">February 15, 2004</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="../undocumented-createprocess.html" class="pagination--pager" title="Undocumented CreateProcess
">Previous</a>
    
    
      <a href="ole-drag-and-drop.html" class="pagination--pager" title="OLE Drag and Drop
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="http://www.catch22.net/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Catch22. Powered by <a href="https://jekyllrb.com/" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="http://www.catch22.net/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>








  </body>

<!-- Mirrored from www.catch22.net/tuts/win32/drag-and-drop-introduction by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 Apr 2022 20:48:45 GMT -->
</html>
