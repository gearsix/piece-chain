<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  
<!-- Mirrored from www.catch22.net/tuts/win32/cards-dll-direct-bitmap-access by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 Apr 2022 20:48:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Cards.dll direct bitmap access - Catch22</title>
<meta name="description" content="The first tutorial I wrote about cards.dll described how to use the exported card-drawing functions ( cdtInit , cdtDraw etc). This tutorial will take a different approach to card drawing. Instead of calling the card-functions, I will show you how to directly access the bitmap resources stored inside cards.dll.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Catch22">
<meta property="og:title" content="Cards.dll direct bitmap access">
<meta property="og:url" content="cards-dll-direct-bitmap-access.html">


  <meta property="og:description" content="The first tutorial I wrote about cards.dll described how to use the exported card-drawing functions ( cdtInit , cdtDraw etc). This tutorial will take a different approach to card drawing. Instead of calling the card-functions, I will show you how to directly access the bitmap resources stored inside cards.dll.">







  <meta property="article:published_time" content="2001-10-01T00:00:00+00:00">






<link rel="canonical" href="cards-dll-direct-bitmap-access.html">













<!-- end _includes/seo.html -->


<link href="http://www.catch22.net/feed.xml" type="application/atom+xml" rel="alternate" title="Catch22 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://www.catch22.net/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--tutorial wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="http://www.catch22.net/">Catch22</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="http://www.catch22.net/blog/" >Blog</a>
            </li><li class="masthead__menu-item">
              <a href="http://www.catch22.net/software/" >Software</a>
            </li><li class="masthead__menu-item">
              <a href="../index.html" >Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="http://www.catch22.net/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://www.catch22.net/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://www.catch22.net/tuts" itemprop="item"><span itemprop="name">Tuts</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
                
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="../win32.html" itemprop="item"><span itemprop="name">Win32</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
                
      
    
      
      
        <li class="current">Cards.dll direct bitmap access</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
    
      
  <div class="file-attachments">
    <h4>DOWNLOADS</h4>
    
      
       <a href="http://www.catch22.net/assets/files/tuts/win32/cards2.zip">cards2.zip</a>      
    
  </div>

    
    

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Cards.dll direct bitmap access">
    <meta itemprop="description" content="The first tutorial I wrote about cards.dll described how to use the exported card-drawing functions ( cdtInit , cdtDraw etc). This tutorial will take a different approach to card drawing. Instead of calling the card-functions, I will show you how to directly access the bitmap resources stored inside cards.dll.">
    <meta itemprop="datePublished" content="October 01, 2001">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Cards.dll direct bitmap access
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <!--h1>Cards.dll direct bitmap access</h1-->
<!--h3>Accessing the cards.dll bitmaps as resources</h3-->

<p>The first tutorial I wrote about cards.dll described how to use the exported card-drawing functions ( <code class="highlighter-rouge">cdtInit</code> , <code class="highlighter-rouge">cdtDraw</code> etc). This tutorial will take a different approach to card drawing. Instead of calling the card-functions, I will show you how to directly access the bitmap resources stored inside cards.dll.</p>

<p><img src="http://www.catch22.net/assets/img/card02.gif" alt="Small card pic" class="align-center" /></p>

<p>This method is about the same complexity as the original one I described, but there is much less work to do when it comes to accessing the bitmaps in the 16bit version of cards.dll.</p>

<h2 id="how-to-load-a-dynamic-link-library-32bits-and-16bits">How to load a Dynamic Link Library (32bits and 16bits)</h2>

<p>There will be two different versions of cards.dll, depending on which operating system our program is run under. For Windows 95,98 and ME, there is a 16bit DLL. Under Windows NT, 2000 and XP, there is a 32bit DLL. Because we don’t know in advance which DLL we will encounter, we need to dynamically load cards.dll.</p>

<p>Under the Windows NT series, this is very simple. All we need is a single call to <code class="highlighter-rouge">LoadLibrary</code>.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HINSTANCE</span> <span class="n">hCardDll</span><span class="p">;</span>

<span class="c1">// Load the dynamic link library
</span><span class="n">hCardDll</span> <span class="o">=</span> <span class="n">LoadLibrary</span><span class="p">(</span><span class="s">"cards.dll"</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="n">hCardDll</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Error, cannot continue
</span>    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Load the bitmap resources
</span><span class="n">LoadCardBitmapsFromLibrary</span><span class="p">(</span><span class="n">hCardDll</span><span class="p">);</span>

<span class="c1">// Release the dynamic link library
</span><span class="n">FreeLibrary</span><span class="p">(</span><span class="n">hCardDll</span><span class="p">);</span>
</code></pre></div></div>

<p>When it comes to the Windows 95 series, there is practically no change. The only difference is we use the undocumented <code class="highlighter-rouge">LoadLibrary16</code> and <code class="highlighter-rouge">FreeLibrary16</code> functions, which are exported from <code class="highlighter-rouge">KERNEL32.DLL</code> as ordinals 35 and 36, respectively. These are still 32bit functions, but they enable the caller to load a 16bit DLL. In order to use these functions from our application we need to create a <code class="highlighter-rouge">.DEF</code> file with the following content:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LIBRARY</span> <span class="n">KERNEL32</span>

<span class="n">EXPORTS</span>
    <span class="n">LoadLibrary16</span><span class="err">@</span><span class="mi">4</span> <span class="err">@</span><span class="mi">35</span>
    <span class="n">FreeLibrary16</span><span class="err">@</span><span class="mi">4</span> <span class="err">@</span><span class="mi">36</span>
</code></pre></div></div>

<p>This is only half-way there. In order for our application to correctly link to these functions, we need to create an import library. The <code class="highlighter-rouge">LIB.EXE</code> tool that ships with the Platform SDK performs this task, and is located in the <code class="highlighter-rouge">PlatformSDK\bin\link</code> directory. Also, LIB.EXE that ships with Visual C++ (in the <code class="highlighter-rouge">VC98\bin\link</code> directory) will also do the job. Run <code class="highlighter-rouge">LIB.EXE</code> with the DEF file above to create our import library.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lib</span> <span class="o">/</span><span class="n">machine</span><span class="o">:</span><span class="n">IX86</span> <span class="o">/</span><span class="n">def</span><span class="o">:</span><span class="n">cards16</span><span class="p">.</span><span class="n">def</span>
</code></pre></div></div>

<p>Now that we have our import library, cards16.lib, we can link this with our application and then call <code class="highlighter-rouge">LoadLibrary16</code> and <code class="highlighter-rouge">FreeLibrary16</code> in the exact same way as before.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Include a library-search record in the object file.
// This causes cards16.dll to be automatically linked in!
</span><span class="cp">#pragma comment( lib, "cards16.lib" )
</span>
<span class="c1">// Need to prototype the two undocumented functions, because
// they don't appear in windows.h
</span><span class="n">HINSTANCE</span> <span class="n">WINAPI</span> <span class="n">LoadLibrary16</span><span class="p">(</span><span class="n">PSTR</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">WINAPI</span> <span class="n">FreeLibrary16</span><span class="p">(</span><span class="n">HINSTANCE</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HINSTANCE</span> <span class="n">hCardDll</span><span class="p">;</span>

<span class="c1">// Load the dynamic link library
</span><span class="n">hCardDll</span> <span class="o">=</span> <span class="n">LoadLibrary16</span><span class="p">(</span><span class="s">"cards.dll"</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="n">hCardDll</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Error, cannot continue
</span>    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Load the bitmap resources
</span><span class="n">LoadCardBitmapsFromLibrary</span><span class="p">(</span><span class="n">hCardDll</span><span class="p">);</span>

<span class="c1">// Release the dynamic link library     
</span><span class="n">FreeLibrary16</span><span class="p">(</span><span class="n">hCardDll</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="accessing-the-bitmap-resources">Accessing the bitmap resources</h2>

<p>We can load a bitmap from the resource section of any executable (including DLLs) by using the <code class="highlighter-rouge">LoadBitmap</code> API call. And by a stroke of luck, <code class="highlighter-rouge">LoadBitmap</code> can load bitmaps from 16bit DLLs as well as 32bit DLLs!!! Because we have a valid handle to a DLL (even a 16bit one), <code class="highlighter-rouge">LoadBitmap</code> just seems to treat the resource sections the same, which can only be good for us.</p>

<p>Using <code class="highlighter-rouge">LoadBitmap</code> is really easy. Just specify the DLL <code class="highlighter-rouge">hInstance</code> and a resource ID, and you can load any bitmap you want.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HBITMAP</span> <span class="n">hBitmap</span> <span class="o">=</span> <span class="n">LoadBitmap</span><span class="p">(</span><span class="n">hCardDll</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">dwIndex</span><span class="p">));</span>
</code></pre></div></div>

<p>After a little experimentation, I found that the card bitmaps started with <code class="highlighter-rouge">dwIndex=1</code>. Also, the card bitmaps are stored in increasing order, suit by suit. So, first of all there are 13 clubs (Ace-King), then 13 diamonds, then hearts and spades. A simple <code class="highlighter-rouge">for</code> loop is enough to load each bitmap in turn.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HBITMAP</span> <span class="n">hBitmap</span><span class="p">;</span>
<span class="n">BITMAP</span> <span class="n">bmp</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">cardwidth</span><span class="p">,</span> <span class="n">cardheight</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">52</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// work out the correct card to retrieve
</span>    <span class="n">DWORD</span> <span class="n">dwIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">13</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span>

    <span class="c1">// Load each bitmap in turn
</span>    <span class="n">hBitmap</span> <span class="o">=</span> <span class="n">LoadBitmap</span><span class="p">(</span><span class="n">hCardDll</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">dwIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>

    <span class="c1">// find the bitmap dimensions
</span>    <span class="n">GetObject</span><span class="p">(</span><span class="n">hBitmap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bmp</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">bmp</span><span class="p">);</span>
    <span class="n">cardwidth</span> <span class="o">=</span> <span class="n">bmp</span><span class="p">.</span><span class="n">bmWidth</span><span class="p">;</span>
    <span class="n">cardheight</span> <span class="o">=</span> <span class="n">bmp</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">;</span>

    <span class="c1">// * create a large memory DC now we know the bitmap size (first time only)
</span>    <span class="c1">// * copy bitmap into a large memory DC
</span>
    <span class="c1">// free up the bitmap resource
</span>    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hBitmap</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Take a close look at the first statement in the for-loop. This formula is necessary, because the arrangement of the card-bitmap resources is different than that used by the original <code class="highlighter-rouge">cdtDraw</code> functions. The resources are stored Ace-to-King, suit-by-suit, whilst <code class="highlighter-rouge">cdtDraw</code> enables access to the cards by a face-value grouping arrangement. That is, the aces come first, then all the twos, then the threes etc. Therefore a small bit of maths is required to convert from one arrangement to the other. The result will be that our card bitmaps are in the same order as we are used to.</p>

<p>Obviously its no good just loading the bitmaps and then freeing them again. We will create a memory device-context large enough to store all the bitmaps in, one after the other. This will make it convenient when we want to draw the card bitmaps.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HDC</span> <span class="n">hMemDC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">HBITMAP</span> <span class="n">hMemBitmap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">HDC</span> <span class="n">hCardDC</span><span class="p">;</span>
<span class="p">...</span>

<span class="n">HDC</span> <span class="n">hdc</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Create a memory DC for the big bitmap store
</span><span class="n">hMemDC</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="n">hdc</span><span class="p">);</span>
<span class="n">hMemBitmap</span> <span class="o">=</span> <span class="n">CreateCompatibleBitmap</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">cardwidth</span> <span class="o">*</span> <span class="n">NUMCARDBITMAPS</span><span class="p">,</span> <span class="n">cardheight</span><span class="p">);</span>
<span class="n">SelectObject</span><span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">hMemBitmap</span><span class="p">);</span>

<span class="c1">// Create a temporary DC to store each card bitmap in
</span><span class="n">hCardDC</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="n">hdc</span><span class="p">);</span>

<span class="n">ReleaseDC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>
</code></pre></div></div>

<p>Now we can save off each bitmap as they are loaded.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HANDLE</span> <span class="n">hOld</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">hOld</span> <span class="o">=</span> <span class="n">SelectObject</span><span class="p">(</span><span class="n">hdcCard</span><span class="p">,</span> <span class="n">hBitmap</span><span class="p">);</span>
<span class="n">BitBlt</span><span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">cardwidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cardwidth</span><span class="p">,</span> <span class="n">cardheight</span><span class="p">,</span> <span class="n">hdcCard</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>
<span class="n">SelectObject</span><span class="p">(</span><span class="n">hdcCard</span><span class="p">,</span> <span class="n">hOld</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="fixing-the-card-bitmaps">Fixing the card bitmaps</h2>

<p><img src="http://www.catch22.net/assets/img/card06.gif" alt="Red card pic" /> When you have all the card bitmaps loaded, you will find that whilst all the “black” cards (clubs, spades) have a black single-line border, all of the “red” cards (hearts, diamonds) have a red single-line border. I prefer it when all cards have a black border (like the <code class="highlighter-rouge">cdtDraw</code> function draws them as), so it is necessary to modify each card as it is stored to give them a black border.</p>

<p>The code below draws a single black border around a specific card, once it is stored in the large memory DC.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">xpos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">width</span><span class="p">;</span>
<span class="n">MoveToEx</span><span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="n">width</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">//vertical
</span><span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="n">width</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">LineTo</span> <span class="p">(</span><span class="n">hMemDC</span><span class="p">,</span> <span class="n">xpos</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="drawing-a-card-bitmap">Drawing a card bitmap</h2>

<p>After the loop has finished we can clean up, and then get ready to draw card bitmaps! We will define a function, <code class="highlighter-rouge">CardBlt</code> , which will draw a card bitmap into a specified DC, just like the original <code class="highlighter-rouge">cdtDraw</code> function. Because each card has slightly rounded edges, it would be a nice idea to draw each card with transparent corners. And because each card is the same shape we can forgoe the hassle of getting a transparent blitter working. Instead, I have opted to draw a card in strips - one main strip, and two shorter strips each side. The result is faster than doing a “proper” transparent blit, and is simpler too. Note that this technique assumes that the cards are all of a particular shape. Should the card bitmaps change shape radically in future versions of windows, then this method would fail to draw the cards properly.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">CardBlt</span><span class="p">(</span><span class="n">HDC</span> <span class="n">hdc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCardNum</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">sx</span> <span class="o">=</span> <span class="n">nCardNum</span> <span class="o">*</span> <span class="n">cardwidth</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">cardwidth</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">cardheight</span><span class="p">;</span>

    <span class="c1">//draw main center band
</span>    <span class="n">BitBlt</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">hMemDC</span><span class="p">,</span> <span class="n">sx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">sy</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>

    <span class="c1">//draw the two bits to the left
</span>    <span class="n">BitBlt</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hMemDC</span><span class="p">,</span> <span class="n">sx</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="n">sy</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>
    <span class="n">BitBlt</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hMemDC</span><span class="p">,</span> <span class="n">sx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">sy</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>

    <span class="c1">//draw the two bits to the right
</span>    <span class="n">BitBlt</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">width</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hMemDC</span><span class="p">,</span> <span class="n">sx</span><span class="o">+</span><span class="n">width</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">sy</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>
    <span class="n">BitBlt</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">hMemDC</span><span class="p">,</span> <span class="n">sx</span><span class="o">+</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sy</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">SRCCOPY</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>We’re now ready to draw card bitmaps to our heart’s content. The sample download implements a complete card bitmap loader, and demonstrates drawing the cards.</p>

<p>This tutorial took a different approach to accessing the card bitmaps in <code class="highlighter-rouge">cards.dll</code>. Instead of using a set of well defined functions to draw the bitmaps, we accessed them directly by looking into the resource section of <code class="highlighter-rouge">cards.dll</code>. The complexity of accessing the 16bit version of <code class="highlighter-rouge">cards.dll</code> has also reduced because the flat thunking was not necessary to extract the bitmap resources.</p>

<p>Look out for Part 3 of this card-drawing series, which I will be releasing shortly. In this tutorial I will be presenting the card-game engine I developed whilst programming <a href="http://www.catch22.net/software/shed.asp">Shed</a> (the card-game which you can find on this site). This C++ library provides powerful card handling and drawing support.</p>



  <div class="file-attachments">
    <h4>DOWNLOADS</h4>
    
      
       <a href="http://www.catch22.net/assets/files/tuts/win32/cards2.zip">cards2.zip</a>      
    
  </div>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2001-10-01T00:00:00+00:00">October 01, 2001</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="memory-techniques-part-2.html" class="pagination--pager" title="Memory Techniques - Part 2
">Previous</a>
    
    
      <a href="custom-titlebar.html" class="pagination--pager" title="Custom Titlebar
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="http://www.catch22.net/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Catch22. Powered by <a href="https://jekyllrb.com/" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="http://www.catch22.net/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>








  </body>

<!-- Mirrored from www.catch22.net/tuts/win32/cards-dll-direct-bitmap-access by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 Apr 2022 20:48:44 GMT -->
</html>
