<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  
<!-- Mirrored from www.catch22.net/tuts/neatpad/neatpad-overview by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 Apr 2022 20:48:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Neatpad Overview - Catch22</title>
<meta name="description" content="Introduction">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Catch22">
<meta property="og:title" content="Neatpad Overview">
<meta property="og:url" content="neatpad-overview.html">


  <meta property="og:description" content="Introduction">







  <meta property="article:published_time" content="2005-01-29T00:00:00+00:00">






<link rel="canonical" href="neatpad-overview.html">













<!-- end _includes/seo.html -->


<link href="https://www.catch22.net/feed.xml" type="application/atom+xml" rel="alternate" title="Catch22 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://www.catch22.net/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--tutorial wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="https://www.catch22.net/">Catch22</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://www.catch22.net/blog/" >Blog</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.catch22.net/software/" >Software</a>
            </li><li class="masthead__menu-item">
              <a href="../index.html" >Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="https://www.catch22.net/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="http://www.catch22.net/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://www.catch22.net/tuts" itemprop="item"><span itemprop="name">Tuts</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
                
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="../neatpad.html" itemprop="item"><span itemprop="name">Neatpad</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
                
      
    
      
      
        <li class="current">Neatpad Overview</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      
  <div class="file-attachments">
    <h4>DOWNLOADS</h4>
    
      
       <a href="https://www.catch22.net/assets/files/tuts/neatpad/neatpad1.zip">neatpad1.zip</a>      
    
  </div>

    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Neatpad</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="#" class=""></a></li>
          
            
            

            
            

            <li><a href="neatpad-overview.html" class="active">Neatpad Overview</a></li>
          
            
            

            
            

            <li><a href="loading-text-file.html" class="">Loading a text file</a></li>
          
            
            

            
            

            <li><a href="scrollbars-scrolling.html" class="">Scrollbars & Scrolling</a></li>
          
            
            

            
            

            <li><a href="enhanced-drawing-painting.html" class="">Enhanced Drawing & Painting</a></li>
          
            
            

            
            

            <li><a href="mouse-selection-highlighting.html" class="">Mouse Selection & Highlighting</a></li>
          
            
            

            
            

            <li><a href="scrolling-mouse.html" class="">Scrolling with the Mouse</a></li>
          
            
            

            
            

            <li><a href="margins-and-long-lines.html" class="">Margins and Long Lines</a></li>
          
            
            

            
            

            <li><a href="introduction-unicode.html" class="">Introduction to Unicode</a></li>
          
            
            

            
            

            <li><a href="unicode-text-processing.html" class="">Unicode Text Processing</a></li>
          
            
            

            
            

            <li><a href="transparent-text.html" class="">Transparent Text</a></li>
          
            
            

            
            

            <li><a href="introduction-uniscribe.html" class="">Introduction to Uniscribe</a></li>
          
            
            

            
            

            <li><a href="uniscribe-mysteries.html" class="">Uniscribe Mysteries</a></li>
          
            
            

            
            

            <li><a href="more-uniscribe-mysteries.html" class="">More Uniscribe Mysteries</a></li>
          
            
            

            
            

            <li><a href="drawing-styled-text-uniscribe.html" class="">Drawing styled text with Uniscribe</a></li>
          
            
            

            
            

            <li><a href="integrating-usplib.html" class="">Integrating UspLib</a></li>
          
            
            

            
            

            <li><a href="keyboard-navigation.html" class="">Keyboard Navigation</a></li>
          
            
            

            
            

            <li><a href="piece-chains.html" class="">Piece Chains</a></li>
          
            
            

            
            

            <li><a href="unicode-text-editing.html" class="">Unicode Text Editing</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Neatpad Overview">
    <meta itemprop="description" content="Introduction">
    <meta itemprop="datePublished" content="January 29, 2005">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Neatpad Overview
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <!--h1>Neatpad Overview</h1-->
<!--h3>Introduction to the Win32 Text Editor series</h3-->

<h2 id="introduction">Introduction</h2>

<p>Welcome to the brand new tutorial series - “Design and Implementation of a Win32 Text Editor!” The purpose of these tutorials is to follow the development of a win32 text editor - codenamed <em>Neatpad</em>. Each tutorial will take you step-by-step over the major components and design decisions that lay ahead.</p>

<p><img src="https://www.catch22.net/assets/img/editor08.gif" alt="&lt;&gt;" /></p>

<p>Now, whilst the title says “text-editor”, this is not the real goal of this tutorial series. Rather, we will aim to write a complete edit control which will be able to provide the core editing front-end for a text editor. Of course, we will have to build a small test application (Neatpad) to test the code with, but we will not go any further than the standard Windows Notepad goes.</p>

<h2 id="alternative-win32-solutions">Alternative Win32 Solutions</h2>

<p>Before we begin you should also check out the following three win32 open-source editor components:</p>

<p><a href="http://www.scintilla.org/">Scintilla</a>, <a href="http://www.codeproject.com/editctrl/brainchild.asp">Brainchild</a> and <a href="http://www.codeproject.com/editctrl/crysedit.asp">CrystalEdit</a>.</p>

<p>Scintilla in particular looks very nice (it has loads of good features) however all three editors suffer from a large, unwieldy code-base, and all have limitations in their memory-management schemes meaning that large files are not handled particularly smartly.</p>

<h2 id="text-editor-resources">Text Editor Resources</h2>

<p>The following set of resources discuss text editor <em>design</em> rather than individual applications, so you may find it a useful exercise to look through the links and read what’s there.</p>

<p><a href="http://www.cs.unm.edu/~crowley/papers/sds/sds.html">Data Structures For Text Sequences</a></p>

<p>Compares and describes many different text editor data structures. The author (Charles Crowley) has done a very good job, although no sample code is available. The one that stands out is the “Piece Table” method which is where the original idea for my HexEdit design originated. This will be the method we will use for our own text editor. The link above is quite old and is no longer accessible from the main page. Also the images are missing. However the complete PostScript version may be downloaded <a href="http://ned.rubyforge.org/doc/crowley98data.ps.gz">here</a>. I also have a <a href="https://www.catch22.net/sites/default/files/crowley.zip">PDF version</a> which can be downloaded directly.</p>

<p><a href="http://www.finseth.com/craft/index.html">The Craft of Text Editing</a></p>

<p>Discusses issues related to the design of the EMACS text editor. Although a very well-known editor (primarily for it’s user-interface) it appears to use a “buffer gap” method so presumably EMACS is not too good for larger files.</p>

<p><a href="http://www.canberra.edu.au/~scott/C=Hacking/C-Hacking11/zedace.html">Design and Implementation of an Advanced Text Editor</a></p>

<p>Whilst the text editor described is not advanced at all (calling it “basic” would be an overstatement), the document does contain some interesting ideas about text editors and user interfaces.</p>

<p><a href="http://ned.rubyforge.org/">ned.rubyforge.org</a></p>

<p>Contains a nice selection of links to other text-editing documents and websites.</p>

<h2 id="edit-control-requirements">Edit-control requirements</h2>

<p>The very first thing we must do is to make sure that there aren’t any text controls already available which will do the job perfectly well. I imagine that anyone who is reading this has come to the same conclusions that I have - the standard Windows edit and rich-edit controls are not up to scratch - they are slow, don’t handle large files and have bad flicking problems for a start, and boy do I hate apps that flicker :-)</p>

<p>The primary reason I want to start this project is as a learning exercise - for me and for anyone else who reads this series. So now that we have decided to make our own edit control, the next step is to decide what features the edit control will have. This is important, because these initial design ideas can have big impacts on the final implementation. So, in no particular order, here are the features that I want an edit control to offer:</p>

<ul>
  <li>Unlimited file size and line length editing with little (or no) degradation in performance for larger files.</li>
  <li>Fast, smooth graphic display. This includes text selection and smooth scrolling with no artifacts or glitches.</li>
  <li>Syntax colouring. Come on, we’re programmer’s after all, so what good is an edit control that can’t syntax-colour our source-code :-)</li>
  <li>Full Clipboard and Drag-and-Drop support.</li>
  <li>Single-font only. We will start by limiting this even further to fixed-width fonts, but with a view to handling variable width fonts if it doesn’t look too difficult :-)</li>
  <li>Complete Undo and Redo support.</li>
  <li>ASCII, Unicode and UTF-8 compatible.</li>
</ul>

<p>I’m sure that I’ll dream up extra features as we move through this article series, but for now I think that’ll be enough :-)</p>

<h2 id="choice-of-language">Choice of language</h2>

<p>This is a tough one. Realistically speaking we have the choice between C and C++. C is good because everyone can compile it, whereas C++ has an advantage that is is easier to write this type of control using it. For this tutorial we are actually going to use a mixture of C and C++. The text editor control will be written using C++, but we will provide a “C” interface to the control, because our main application (Neatpad) will be written in “pure win32” C.</p>

<p>Don’t expect this control to be available in .NET, or Visual Basic, or any other high-level language. Maybe towards the end of this article series we will look at putting the editor control in an external DLL so that other languages can use it, but for now this is a pure C/C++ solution with no 3rd party libraries.</p>

<h2 id="design-of-a-text-editor">Design of a Text Editor</h2>

<p>A text editor is conceptually very simple. Just take a look at Notepad - all it has is a main window and an “edit” control inside this main window. This is the design we will follow when we are implementing our text editor.</p>

<p>The diagram below illustrates the key components to a text editor. First of all we have a top-level main window. This is the window that contains the title, menu and status bars. The main window doesn’t know how to edit text files, it’s only purpose is to provide an interface to the user. This component will be written in pure win32 C.</p>

<p><img src="https://www.catch22.net/assets/img/editor01.gif" alt="&lt;&gt;" /></p>

<p>The most important component is the “TextView”. This is a separate window that is a child of the main (parent) window. The TextView is the visual component of a text editor. This control’s primary purpose is to display and edit text, but it needs to do other things besides this, such as display scrollbars, process mouse and keyboard input, support drag and drop etc.</p>

<p>The “TextDocument” component is not a visible one, but is used to store and manipulate a text file once it has been loaded into memory. The text object has no concept of windows, mice, drawing or painting. All it knows how to do is manipulate text, and supply text to the edit control when it wants to draw something.</p>

<p>The last component is not really part of a text editor, but plays an important role none-the-less. It is the disk-file that stores the text we want to edit. The TextDocument will interface directly with this text file, reading and writing to it when it is time to load or save a new document.</p>

<p>It is important to separate the TextView from the data it stores (the TextDocument). This has two major benefits. One is that we can attach multiple edit controls to one text object - this will enable us to add “split-views” sometime in the future. The biggest advantage is that we can change the way we store and represent a text file at any time without this impacting upon the design of the visual component.</p>

<p>One thing to note on the component design are the “interfaces” between the various components. The TextView is a line-oriented, graphical entity. Most of the work performed by the edit-window will be updating the display. This will entail retreiving data from the TextDocument on a line-by-line basis.</p>

<p>On the other end of the scale is the interface between the TextDocument and the disk-file. Rather than using a line-by-line strategy, the TextDocument will either load the entire file into memory in one go, or access the file in manageable chunks. No matter how this happens, we’ve got some interesting design decisions ahead :-)</p>

<h2 id="neatpad---a-win32-text-editor">Neatpad - a Win32 Text Editor</h2>

<p>At the top of this tutorial there is a link to a zip-file, which contains the sourcecode to a skeleton text editor. I have called this project “Neatpad” in passing reference to the standard Windows Notepad.</p>

<p>When you unzip the download, there will be a single Visual C++ project workspace ( <strong>neatpad.dsw</strong> ) and two subdirectories ( <strong>Neatpad</strong> and <strong>TextView</strong> ). The Neatpad directory contains several files, the important ones listed below:</p>

<ul>
  <li><code class="highlighter-rouge">neatpad.c</code> - the main Neatpad application source file.</li>
  <li><code class="highlighter-rouge">resource.rc/h</code> - Neatpad’s resources.</li>
  <li><code class="highlighter-rouge">neatpad.dsp</code> - the Visual Studio project.</li>
</ul>

<p>It is intended that you work using the main neatpad.dsw workspace in the top-level directory. From this workspace you can build the complete project (Neatpad and TextView). Although the workspace and projects are in Visual Studio 6.0 format, it shouldn’t be difficult to convert the projects to other IDEs.</p>

<h2 id="textview---a-win32-custom-control">TextView - a Win32 Custom Control</h2>

<p>The TextView directory contains the source-code to a skeleton win32 custom control, implemented using C++. The control does nothing apart from display “Hello World” in it’s window - in fact most of the code is simply what is required to register and create the empty TextView window.</p>

<p>There are four files in the TextView directory - TextView.dsp, TextView.c, TextView.h and TextViewInternal.h:</p>

<ul>
  <li><code class="highlighter-rouge">TextView.h</code> - the “public interface” to the TextView control.</li>
  <li><code class="highlighter-rouge">TextView.c</code> - the main implementation of the TextView window.</li>
  <li><code class="highlighter-rouge">TextViewInternal.h</code> - the private header file used by TextView.c, and contains the TextView C++ class definition.</li>
  <li><code class="highlighter-rouge">TextView.dsp</code> - the Visual Studio project.</li>
</ul>

<p>Most of the future tutorials will concentrate on adding functionality to the TextView project.</p>

<h2 id="public-interface-to-the-textview">Public Interface to the TextView</h2>

<p>The basic method of controlling the TextView will be Windows Messages, using the <code class="highlighter-rouge">SendMessage</code> API, just like you would use with a standard Edit control. To achieve this we need to define a range of message values that we can use. These message values will be defined in the “public” TextView.h, so whenever you want to use the TextView control in your projects, simply <code class="highlighter-rouge">#include</code> TextView.h:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define TEXTVIEW_CLASS "TextView32"
</span>
<span class="cp">#define TXM_BASE (WM_USER)
#define TXM_OPENFILE (TXM_BASE + 0)#define TextView_OpenFile(hwndTV, szFile) \
                  SendMessage((hwndTV), TXM_OPENFILE, 0, (LPARAM)(szFile))
</span></code></pre></div></div>

<p>As you can see only one message has been defined so far - <code class="highlighter-rouge">TXM_OPENFILE</code>. As we progress through this tutorial and add more functionality to the TextView, so we will add more messages as well. i imagine that our TextView will also support the standard <code class="highlighter-rouge">EM_xxx</code> edit control messages as well, so our TextView could be a simple drop-in replacement for that control.</p>

<p>The macro defined above (<code class="highlighter-rouge">TextView_OpenFile</code>) provides an alternative interface to the control. It is basically a wrapper around the <code class="highlighter-rouge">SendMessage</code> call and makes it easier to use. An example of opening a file is shown below:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TextView_OpenFile</span><span class="p">(</span><span class="n">hwndTextView</span><span class="p">,</span> <span class="s">"C:</span><span class="se">\\</span><span class="s">SRC</span><span class="se">\\</span><span class="s">TEXTVIEW</span><span class="se">\\</span><span class="s">README.TXT"</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="coming-up-in-part-2">Coming up in Part 2</h2>

<p>This first part in the tutorial series was really just an introduction to what we are trying to achieve. I have assumed that the reader (you) as at least some knowledge of C and Win32 because you will need a reasonable level of programming experience if you intend to benefit from these tutorials. Please take some time to study the skeleton project download - the code is very simple but it is important that you understand how the various components are all going to plug together.</p>

<p>Future tutorials will begin to flesh out the functionality of the text-view control. As I’ve been experimenting with text editors I have drawn up a list of steps that I believe will be necessary to cover. The list below will hopefully give you an idea of the sequence of this tutorial series.</p>

<ul>
  <li>Drawing lines of text</li>
  <li>Scrolling and scrollbars</li>
  <li>Selection and highlighting using the mouse</li>
  <li>Syntax colouring</li>
  <li>Ascii, Unicode and UTF-8</li>
  <li>Keyboard and Mouse input</li>
  <li>Highlighting and text-selection.</li>
  <li>Selection margin and borders.</li>
  <li>Loading large files</li>
  <li>Editing large files</li>
  <li>Undo and Redo</li>
  <li>Clipboard and Drag+Drop</li>
  <li>Scrolling with the mouse</li>
  <li>Searching for data</li>
  <li>Folding editors</li>
</ul>

<p>I will try and stick to the above topics as closely as possible, but bear in mind that I don’t have a fixed project plan, so we will see this text editor evolve incrementally over the next few weeks.</p>



  <div class="file-attachments">
    <h4>DOWNLOADS</h4>
    
      
       <a href="https://www.catch22.net/assets/files/tuts/neatpad/neatpad1.zip">neatpad1.zip</a>      
    
  </div>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2005-01-29T00:00:00+00:00">January 29, 2005</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="../neatpad.html" class="pagination--pager" title="Design &amp; Implementation of a Win32 Text Editor
">Previous</a>
    
    
      <a href="loading-text-file.html" class="pagination--pager" title="Loading a text file
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="https://www.catch22.net/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Catch22. Powered by <a href="https://jekyllrb.com/" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="https://www.catch22.net/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.6.0/js/all.js" integrity="sha384-z9ZOvGHHo21RqN5De4rfJMoAxYpaVoiYhuJXPyVmSs8yn20IE3PmBM534CffwSJI" crossorigin="anonymous"></script>








  </body>

<!-- Mirrored from www.catch22.net/tuts/neatpad/neatpad-overview by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 Apr 2022 20:48:41 GMT -->
</html>
